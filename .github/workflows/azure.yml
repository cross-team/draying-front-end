name: Linux_Node_Workflow_ScmCred

on:
  push:
    branches:
    - master
    - dev

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    env: 
        MIDDLE_END_URL: ${{ secrets.MIDDLE_END_URL }}
    steps:
    - uses: actions/checkout@master
    - uses: actions/setup-node@v1
      with:
        node-version: '10.x'
    - name: 'run npm'
      run: |
        npm install
        npm run build --if-present
        npm run test --if-present
    - name: Azure Static Website Deploy
      uses: bacongobbler/azure-blob-storage-upload@v1.0.0
      with:
        source_dir: ./public
        container_name: $web
        connection_string: ${{ secrets.ConnectionString }}
#       uses: feeloor/azure-static-website-deploy@v0.1.0
#       with:
#         SOURCE_DIR: "./public"
#         AZURE_CLIENT_ID: ${{ secrets.AZURE_CLIENT_ID }}
#         AZURE_TENANT_ID: ${{ secrets.AZURE_TENANT_ID }}
#         AZURE_SECRET: ${{ secrets.AZURE_SECRET }}
#         AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
#         AZURE_STORAGE_ACCOUNT_NAME: ${{ secrets.AZURE_STORAGE_ACCOUNT_NAME }}
#         AZURE_INDEX_DOCUMENT_NAME: "index.html"
#         AZURE_ERROR_DOCUMENT_NAME: "404.html"
